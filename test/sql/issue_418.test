# name: test/sql/issue_418.test
# description: regression test for issue 418
# group: [sql]

require notwindows

require cache_httpfs

statement ok
SET cache_httpfs_type='on_disk';

# Single cache directory with trailing slash
statement ok
SET cache_httpfs_cache_directory='/tmp/duckdb_cache_issue_418/';

statement ok
SELECT cache_httpfs_clear_cache();

query I
SELECT COUNT(*) FROM read_csv_auto('https://raw.githubusercontent.com/dentiny/duck-read-cache-fs/refs/heads/main/test/data/stock-exchanges.csv');
----
251

query IIIII
SELECT * FROM cache_httpfs_cache_status_query() ORDER BY cache_filepath;
----
(no disk cache)	https://raw.githubusercontent.com/dentiny/duck-read-cache-fs/refs/heads/main/test/data/stock-exchanges.csv	0	16222	in-mem-disk-cache
/tmp/duckdb_cache_issue_418/c1b7e15bc8fe00a09fd6ea693ca6bdf109f622f26f4c6b34ad568a300854b5e2-stock-exchanges.csv-0-16222	stock/exchanges.csv	0	16222	on-disk
