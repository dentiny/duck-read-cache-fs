# name: test/sql/memory_cache_for_disk_cache.test
# description: test IO operations when memory cache enabled for disk cache reader
# group: [sql]

require notwindows

require cache_httpfs

require parquet

statement ok
SET cache_httpfs_type='on_disk';

statement ok
SET cache_httpfs_disk_cache_reader_enable_memory_cache=true;

statement ok
SET cache_httpfs_cache_directories_config='/tmp/duckdb_cache_httpfs_cache';

statement ok
SELECT cache_httpfs_clear_cache();

# Check no cache entry after clearing cache.
query IIIII
SELECT * FROM cache_httpfs_cache_status_query();
----

query I
SELECT COUNT(*) FROM read_csv_auto('https://raw.githubusercontent.com/dentiny/duck-read-cache-fs/refs/heads/main/test/data/stock-exchanges.csv');
----
251

query I
SELECT COUNT(*) FROM read_parquet('https://blobs.duckdb.org/data/taxi_2019_04.parquet');
----
7433139
